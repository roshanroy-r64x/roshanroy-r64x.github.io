{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"EGR 304 Embedded Systems Design","text":"Roshan Roy Geoffrey Joe Datasheet as part of  ClapSense for  Team 204  <p>Submission: December 01, 2025 </p><p></p>","tags":["tag1","tag2"]},{"location":"#introduction","title":"Introduction","text":"<p>This page documents the Distance Front-End Subsystem developed by Roshan as part of Team 204\u2019s EGR 304 project. The purpose of this subsystem is to measure the proximity of a movable slider using a distance sensor and use that data to control the brightness of an LED. This GitHub page provides an overview of the subsystem\u2019s hardware architecture, selected components, signal and power interfacing, and how this board integrates into the overall ClapSense system.</p>","tags":["tag1","tag2"]},{"location":"#project-summary","title":"Project Summary","text":"<p>ClapSense is an interactive lighting system that allows users to turn lights on and off with a clap. The system is designed to provide simple and intuitive control\u2014especially useful for users seeking convenient lighting adjustments without physical switches. Additionally, it allows manual dimming and brightness adjustment.</p> <p>The Distance Front-End Board is responsible for detecting the position of a slider relative to a distance sensor and translating that input into a variable brightness output. The subsystem uses a Sharp GP2Y0A21YK0F analog distance sensor to measure distance, feeding its signal through an MCP6002 op amp before reaching the PIC18F57Q43 Curiosity Nano\u2019s ADC. The microcontroller then uses this analog value to adjust the LED brightness via PWM output.</p> <p>When the slider moves closer to the distance sensor, the LED dims through the corresponding potentiometer adjustment. Conversely, when the slider moves away from the distance sensor, the LED brightens, demonstrating a dynamic feedback system controlled by physical distance.</p> <p>Attached here is the link to our team report.</p>","tags":["tag1","tag2"]},{"location":"#my-contribution","title":"My Contribution","text":"<p>My contribution focuses on designing and implementing the Distance Front-End subsystem, which includes:</p> <ul> <li>Integrating the Sharp GP2Y0A21YK0F analog IR distance sensor and buffering its output with an MCP6002 op amp for stable ADC readings.</li> <li>Configuring the PIC18F57Q43 peripherals\u2014using ADC for sensor input and PWM for LED brightness control based on distance.</li> <li>Implementing a dynamic brightness system where moving a slider closer to the distance sensor dims the LED, and moving it away brightens the LED through the potentiometer interface.</li> <li>Ensuring proper power management using a LM7805 regulator to provide a stable 5 V supply shared across the sensor, op amp, and microcontroller.</li> <li>Establishing clean signal mapping across boards through an 8-pin connector, maintaining consistent labeling and power distribution between subsystems.</li> </ul> <p>This subsystem provides the real-time analog interface between physical user interaction and visible system output, playing a key role in connecting sensory input to light control.</p> <p>To review the details listed of the material used to construct the subsection, you can review it in the BOM section of the datasheet.</p>","tags":["tag1","tag2"]},{"location":"01-Block-Diagram/Block-Diagram/","title":"Individal Block Diagram","text":"","tags":["tag1","tag2"]},{"location":"01-Block-Diagram/Block-Diagram/#overview","title":"Overview","text":"<p>Below is the individual block diagram for the Distance Front End of the overall board. This board receives the distance input and adjusts the potentiometer to dim or brighten an LED.</p>","tags":["tag1","tag2"]},{"location":"01-Block-Diagram/Block-Diagram/#block-diagram","title":"Block Diagram","text":"","tags":["tag1","tag2"]},{"location":"02-Component-Selection/Component-Selection/","title":"Component Selection","text":""},{"location":"02-Component-Selection/Component-Selection/#voltage-regulator-module","title":"Voltage Regulator Module","text":"Solution Pros Cons  TI LM7805CT/NOPB$0.75/eachLink to product * Easy to heatsink* Compatible with PSoC* Up to 1\u20131.5 A * Higher dropout (~2 V); can run hot \u2192 bigger thermal budget  Microchip MCP1825S-5002E/DB  $0.70/each  Link to product * 500 mA LDO * lower dropout than 7805  * compact SOT-223 package * SMD reflow/soldering skill needed * less tolerant of big thermal loads  AMS1117-5.0$0.13/eachLink to product * 1 A rating* Compact * Moderate dropout (~1.1\u20131.3 V) * Current higher than some LDOs * Dip in quality <p>Choice: LM7805CT/NOPB</p> <p>Rationale: Meets the project\u2019s 500 mA requirement and compatible with the PSoC. Same voltage regulator as the rest of the group so consistency maintained as well.</p>"},{"location":"02-Component-Selection/Component-Selection/#op-amp-module","title":"Op-Amp Module","text":"Solution Pros Cons  TI LM358$0.50/eachLink to product * Dual amp; single-supply 5 V operation* Tolerant of inputs near ground * Not rail-to-rail in/out* Input bias &amp; offset higher than modern CMOS parts  MCP6002-E/P  $0.60/each  Link to product * Rail-to-rail I/O * Great at 5 V or 3.3 V  * Good for sensor buffering * Lower GBW (1 MHz) may limit high-speed filtering  TLV2372IDR$1.45/eachLink to product * Rail-to-rail* 3 MHz GBW; more headroom* low power per channel * Higher cost * SOIC/T&amp;R variants may require SMD rework skills <p>Choice: MCP6002</p> <p>Rationale: For an ambient-light signal into the PIC\u2019s ADC, rail-to-rail I/O, low power, and clean operation at 5 V are more valuable than bandwidth. MCP6002 gives simpler headroom management than LM358 with minimal cost increase.</p>"},{"location":"02-Component-Selection/Component-Selection/#distance-sensor-module","title":"Distance Sensor Module","text":"Solution Pros Cons GP2Y0A21YK0F$12.41/eachLink to product * 10\u201380 cm analog IR distance sensing * 5 V supply compatible with system rail* Simple 3-wire hookup (Vcc, Out, GND) * Non-linear analog output curve* Accuracy \u00b110% typical* Sensitive to color/surface reflectivity  HC-SR04 Ultrasonic Module $5.25/each  Link to product * 2 \u2013 400 cm range* Low  cost and 5 volts* Easy firmware via trigger/echo timing * Requires two I/O pins* Unreliable on soft/angled targets* Bulkier than IR sensor  Adafruit VL53L1X Time of Flight Distance Sensor - ~30 to 4000mm - STEMMA QT / Qwiic$14.95/eachLink to product * 4 m max range* High precision and narrow field of view* I\u00b2C digital output with built-in filtering * Needs 3.3 V rail + level shifting* More complex firmware (I\u00b2C driver) <p>Choice: Sharp GP2Y0A21YK0F</p> <p>Rationale: Operates directly from the 5 V rail and outputs an analog voltage enough for the PIC ADC, eliminating extra signal-conditioning hardware. It covers the intended 10\u201380 cm detection zone with low power draw and minimal code overhead, ideal for quick integration into the Distance Front End.</p>"},{"location":"03-BOM/BOM/","title":"Bill of Materials","text":"","tags":["tag1","tag2"]},{"location":"03-BOM/BOM/#overview","title":"Overview","text":"<p>This section is the BOM (Bill of Materials) for the ClapSense sensor front end subsystem.</p>","tags":["tag1","tag2"]},{"location":"03-BOM/BOM/#bill-of-materials","title":"Bill of Materials","text":"<p>Table 01: Components for audio subsystem.</p> Part Name/Description Qty Unit Cost Total Cost Manufacture Manufacturer # Vendor Link Datasheet Link Schematic Reference Designators Sharp Electronic Components GP2Y0A21YK0F Distance Sensors 1 $6.95 $6.95 Sharp GP2Y0A21YK0F Jameco Electronics datasheet link S1 MCP6002 OP AMP 1 $1.86 $ 1.86 Microchip Technology MCP6002-I/P-ND Peralta 109 datasheet MCP6002_RRGJ1 PJ-102AH Barrel Jack 1 $0.76 $ 0.76 Same Sky CP-102AH-ND Peralta 109 datasheet link J1 330 ohm resistor 1 $0.10 $ 0.10 Stackpole Electronics Inc CF14JT330R Peralta 109 datasheet link R10 1K ohm resistor 1 $0.10 $ 0.30 Stackpole Electronics Inc CF14JT1K00 Peralta 109 datasheet link R8 5.6K ohm resistor 1 $0.10 $ 0.30 Stackpole Electronics Inc CF14JT1K00 Peralta 109 datasheet link R1 10K ohm resistor 7 $0.10 $0.70 Stackpole Electronics Inc CF14JT10K0 Peralta 109 datasheet link R2, R9 .33uF Ceramic capacitor 1 $0.72 $ 0.72 Vishay Beyschlag/Draloric/BC Components 1C10Z5U334M050B Peralta 109 datasheet link C1 .1uF Ceramic capacitor 2 $0.24 $ 0.72 Vishay Beyschlag/Draloric/BC Components K104K10X7RF5TL2 Peralta 109 datasheet link C2, C3,C4, C5, C6 Button Switch 1 $0.50 $ 0.50 SparkFun Electronics 00097 Peralta 109 Not Provided SW1 Red LED 1 $0.15 $ 0.15 W\u00fcrth Elektronik 151051RS11000 Peralta 109 datasheet link D1 Curiosity Nano PIC18F57Q43 Microchip 1 $9.99 $ 9.99 Microchip technology DM164150 Peralta 109 datasheet link PIC_RRGJ1 10K\u03a9 Potentiometer 1 $1.87 $ 1.87 TT Electronics/BI P160KN-0QC15B10K Peralta 109 datasheet link RV1 +5V Voltage Regulator 1 $1.80 $1.80 Digikey LM7805CT/NOPB Peralta 109 datasheet link U1 Jumper Wires Multiple - - - - Peralta 109 - - Fuse 1A 1 $0.50 $0.50 Littelfuse Inc. 0217002.MXP Peralta 109 datasheet link F1 2x4 Ribbon Cables 1 $9.31 $9.31 Samtec Inc. FFSD-04-D-04.00-01 Peralta 109 datasheet link J3","tags":["tag1","tag2"]},{"location":"04-Schematic/schematic/","title":"Schematic","text":""},{"location":"04-Schematic/schematic/#overview","title":"Overview","text":"<p>This schematic is the lamp control section of the output drive board for EGR 304 Group 204's project.</p> <p></p>"},{"location":"04-Schematic/schematic/#resouces","title":"Resouces","text":"<p>The schematic as a PDF download is available here, and the Zip folder of the project here.</p>"},{"location":"05-Power-Budget/Power-Budget/","title":"Power Budget (Roshan Roy Geoffrey Joe)","text":""},{"location":"05-Power-Budget/Power-Budget/#overview","title":"Overview","text":"<p>This subsystem is powered from an external 9 V DC wall adapter, which feeds the LM7805 linear regulator to provide a stable +5 V rail for all circuitry. The updated schematic includes the PIC18F57Q43 Curiosity Nano microcontroller board, the GP2Y0A21YK0F distance sensor, the MCP6002 low-power dual op-amp configured as a non-inverting amplifier, a status LED driven by PWM, and a small bias network used for signal conditioning. All of these components draw power exclusively from the +5 V rail. Based on datasheet values and measured expectations, the total operating load on the +5 V rail is 93 mA. Applying a standard 25 percent safety margin increases the required current capacity to 116.25 mA. The LM7805 regulator can supply up to 500 mA, leaving more than 380 mA of available headroom for reliable operation. This ensures that the subsystem remains well within the regulator\u2019s limits while maintaining stable performance across all expected operating conditions.</p> <p></p>"},{"location":"05-Power-Budget/Power-Budget/#resouces","title":"Resouces","text":"<p>The power budget as a PDF download is available here, and a Microsoft Excel Sheet here.</p>"},{"location":"06-PCB-Design/PCB-Design/","title":"PCB Design","text":""},{"location":"06-PCB-Design/PCB-Design/#front-and-back-of-pcb-layout","title":"Front and Back of PCB Layout","text":""},{"location":"06-PCB-Design/PCB-Design/#front","title":"Front","text":""},{"location":"06-PCB-Design/PCB-Design/#back","title":"Back","text":""},{"location":"06-PCB-Design/PCB-Design/#working-breadboard","title":"Working Breadboard","text":""},{"location":"06-PCB-Design/PCB-Design/#pcb","title":"PCB","text":"<p>The front and back as a PDF is available here, and the Zip folder of the project here.</p>"},{"location":"07-Hardware%20V2.0/Hardware%20V2.0/","title":"Hardware 2.0","text":""},{"location":"07-Hardware%20V2.0/Hardware%20V2.0/#hardware-v20","title":"Hardware V2.0","text":""},{"location":"07-Hardware%20V2.0/Hardware%20V2.0/#distancesignal-conditioning-subsystem-version-20-discussion","title":"Distance/Signal Conditioning Subsystem Version 2.0 Discussion","text":"<p>If I were to create a Version 2.0 of my Distance/Signal Conditioning subsystem, there are several improvements I would make now that I have built the first version, tested it, and integrated it with the rest of the project. The current design performs all of its required functions: it accepts a 9 V input through the barrel jack and fuse, regulates it down to 5 V using the LM7805, powers the GP2Y0A21YK0F distance sensor, conditions the analog output through the MCP6002 op-amp, and sends the processed signal into the PIC18F57Q43. The board also includes a PWM-driven status LED, debouncing components, and labeled connectors for communication. Functionally the system works, but now that the schematic has been translated into a physical PCB, it is much easier to see which areas could be refined for Version 2.0.</p> <p>The first improvement I would target is the power stage. Right now the subsystem uses a linear LM7805 regulator to drop 9 V down to 5 V. With multiple components powered from that rail \u2014 the sensor, the op-amp, and the microcontroller subsystem \u2014 the regulator must dissipate the voltage difference as heat. In the schematic, this entire path flows through the barrel jack, fuse, input capacitor network, and finally into the LM7805 before the 5 V rail branches out to the rest of the design. While this works, a switching regulator would be a far better option in Version 2.0. It would introduce significantly less power loss, keep the board cooler, and improve overall efficiency, especially during long operation where the sensor and amplifier are continuously active.</p> <p>Another improvement relates to the signal conditioning stage. The MCP6002 op-amp performs well for buffering and scaling the distance sensor output, but the current design is very simple \u2014 a single non-inverting gain stage with fixed resistors. After building and testing the system, I realized that having adjustability would be extremely useful. In Version 2.0, I would add either a small multi-turn potentiometer or a jumper-selectable gain configuration. That would allow calibration of the sensor range, compensation for part-to-part variance, and finer control over what analog voltage range maps into the PIC\u2019s ADC. This makes the subsystem more flexible and robust.</p> <p>I would also revise the way the board handles noise and filtering. The GP2Y0A21YK0F is known for producing noisy analog outputs, and while the current design includes decoupling capacitors and a simple RC network, testing revealed that the output still fluctuates more than ideal. In a second version, I would introduce a more deliberate low-pass filter ahead of the op-amp or apply a two-stage amplifier design with dedicated filtering. This would produce a cleaner ADC signal, reduce jitter, and improve measurement stability.</p> <p>Another category of improvement is testability and debugging, which became very noticeable once the board was physically assembled. The Version 1 design has only a few test points, and many nets such as the sensor output, op-amp output, and 5 V rail can only be accessed by probing component pins directly. In Version 2.0, I would add clearly labeled test pads for:</p> <ul> <li> <p>the raw sensor output</p> </li> <li> <p>the amplified signal going into RA0</p> </li> <li> <p>the 5 V regulated rail</p> </li> <li> <p>the 9 V input</p> </li> <li> <p>op-amp supply pins</p> </li> </ul> <p>ground reference These additions would make troubleshooting significantly easier and reduce the risk of accidental shorts when using oscilloscope probes.</p> <p>Another meaningful change would be improving the robustness of the sensor interface. The GP2Y0A21YK0F is sensitive to electrical noise and supply fluctuations. In Version 2.0, I would include additional supply filtering near the sensor connector and possibly ESD protection on the output pin. This would make the system more resistant to transient spikes and improve long-term reliability.</p> <p>Finally, I would reconsider how much of the design depends on the external Curiosity Nano microcontroller board. While the Nano makes development simple, integrating the PIC18F57Q43 directly onto the PCB in Version 2.0 would have several advantages: reduced wiring complexity, cleaner routing, lower cost, and a more professional design overall. The schematic already shows the necessary connections for power, ADC, and debugging; extending this to include the PIC and minimal support components would be a natural progression.</p> <p>Overall, the Version 1 subsystem works well and has been a great learning experience, but Version 2.0 would focus on increasing efficiency, signal quality, debugging capability, and design maturity. Replacing the linear regulator with a switching regulator, adding adjustable gain or additional filtering in the amplifier stage, improving test point access, strengthening sensor protection, and eventually integrating the PIC directly onto the board would all produce a more polished, reliable, and scalable subsystem. These enhancements would make the design far more capable in real-world environments and elevate it from a functional prototype to a refined hardware module.</p> <p>Attached is the code used to verify functionality of the individual subsystem in .zip format, here.</p>"},{"location":"08-Resources/Hardware%20V2.0/","title":"Resources","text":""},{"location":"08-Resources/Hardware%20V2.0/#resources","title":"Resources","text":""},{"location":"08-Resources/Hardware%20V2.0/#microcontroller-code","title":"Microcontroller Code","text":""},{"location":"08-Resources/Hardware%20V2.0/#overall-team-system","title":"Overall Team System","text":"<p>This firmware runs on the PIC18F57Q43 Curiosity Nano and coordinates all three subsystems to control the ClapSense Hub. It reads Aaron's clap detector on RA0 to toggle the hub on and off, checks Quinn's light sensor on RA1 so the motor only runs when the sensor is covered, and processes Roshan's distance sensor signal from RA3 to generate a smooth LED brightness response.</p> <p>A three state motor controller manages OFF, START, and RUN behavior based on clap events, while a distance based brightness table maps ADC readings into six intensity levels that transition gradually using a simple weighted average filter. The main loop and timer interrupts work together to update the motor, LED, and UART logging every 50 ms, creating a responsive and stable embedded system that combines all three sensor inputs into one integrated behavior.</p>"},{"location":"08-Resources/Hardware%20V2.0/#downloads","title":"Downloads","text":"<ul> <li>Team Subsystem Hardware Functionality project ZIP</li> </ul>"},{"location":"08-Resources/Hardware%20V2.0/#individual-subsystem","title":"Individual Subsystem","text":"<p>This program implements the individual Distance and Signal Conditioning subsystem that Roshan designed. The PIC18F57Q43 reads the analog output of the GP2Y0A21YK0F distance sensor through the MCP6002 op amp on RA0, converts the value with the ADC, and maps the result to a PWM duty cycle that drives a status LED. As an object moves closer or farther from the sensor, the LED brightness changes smoothly, giving a clear visual indication of measured distance.</p> <p>To make the readings reliable, the code averages multiple ADC samples and applies simple filtering to reduce noise from the sensor. Calibration constants and scaling factors convert raw counts into usable brightness levels, and the firmware continuously updates the LED inside the main loop using a timer based refresh so that the output does not flicker. This demonstrates a complete embedded signal chain from analog sensing through conditioning, conversion, and real time visual feedback.</p>"},{"location":"08-Resources/Hardware%20V2.0/#downloads_1","title":"Downloads","text":"<ul> <li>Individual Distance Subsystem Hardware Functionality project ZIP</li> </ul>"}]}